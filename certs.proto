// Copyright (c) Abstract Machines
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";

package absmach.certs;

import "google/protobuf/empty.proto";

import "google/protobuf/timestamp.proto";

option go_package = "./certs";

service CertsService {
  rpc GetEntityID(EntityReq) returns (EntityRes) {}
  rpc RevokeCerts(RevokeReq) returns (google.protobuf.Empty) {}
}

message EntityReq {
  string serial_number = 1;
}

message EntityRes {
  string entity_id = 1;
}

message RevokeReq {
  string entity_id = 1;
}

message Cert {
  string serial_number = 1;
  string certificate = 2;
  string key = 3;
  bool revoked = 4;
  google.protobuf.Timestamp expiry_time = 5;
  string entity_id = 6;
  string download_url = 7;
}

message CertificateBundle {
  bytes ca = 1;
  bytes certificate = 2;
  bytes private_key = 3;
}

message RetrieveCertReq {
  string download_token = 1;
  string serial_number = 2;
}

message RetrieveCertDownloadTokenReq {
  string domain_id = 1;
  string serial_number = 2;
  string user_id = 3;
}

message RetrieveCertDownloadTokenRes {
  string token = 1;
}

message Options {
  string common_name = 1;
  repeated string organizations = 2;
  repeated string organizational_units = 3;
  repeated string countries = 4;
  repeated string provinces = 5;
  repeated string localities = 6;
  repeated string street_addresses = 7;
  repeated string postal_codes = 8;
  repeated string dns_names = 9;
  repeated string ip_addresses = 10;
}

message IssueCertReq {
  string domain_id = 1;
  string entity_id = 2;
  string entity_type = 3;
  repeated string ip_addresses = 4;
  string user_id = 5;
  string ttl = 6;
  Options subject_options = 7;
}

message IssueCertRes {
  string serial_number = 1;
}

message GetCAReq {
}

